<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PEC Navigator</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-routing-machine/3.2.12/leaflet-routing-machine.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap">
    <style>
        body {
            font-family: 'Orbitron', sans-serif;
            background-color: #0a0a0a;
            color: #00ffcc;
            text-align: center;
        }
        h1 {
            font-size: 3rem;
            text-transform: uppercase;
            animation: glow 1.5s infinite alternate;
        }
        @keyframes glow {
            from { text-shadow: 0 0 10px #00ffcc, 0 0 20px #00ffcc; }
            to { text-shadow: 0 0 20px #00ffcc, 0 0 30px #00ffcc; }
        }
        #controls {
            margin: 20px auto;
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        select, button {
            font-size: 1rem;
            padding: 10px;
            border-radius: 10px;
            border: none;
            background: #222;
            color: #00ffcc;
        }
        button:hover {
            background: #00ffcc;
            color: #222;
        }
        #map { height: 600px; width: 90%; margin: auto; border-radius: 10px; }
    </style>
</head>
<body>
    <h1>PEC Navigator</h1>
    <div id="controls">
        <label for="source">Source:</label>
        <select id="source"></select>
        
        <label for="destination">Destination:</label>
        <select id="destination"></select>
        
        <button onclick="calculateRoute()">Show Route</button>
    </div>
    <div id="map"></div>

    <script>
        var map = L.map('map', {
            center: [13.0520, 80.0750],
            zoom: 17
        });

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        var locations = {
            "Placement Cell": [13.04870377560546, 80.07519564034887],
            "Admin Block": [13.049020818392096, 80.0754864596096],
            "Mess": [13.051089575922814, 80.07448623699234],
            "Library": [13.052019775498016, 80.0760472825917],
            "AI&DS Block": [13.049600204129447, 80.07690022508207]
        };

        var markers = {};
        Object.entries(locations).forEach(([name, coords]) => {
            markers[name] = L.marker(coords).addTo(map).bindPopup(name);
            document.getElementById("source").innerHTML += `<option value="${coords}">${name}</option>`;
            document.getElementById("destination").innerHTML += `<option value="${coords}">${name}</option>`;
        });

        function calculateRoute() {
            var src = document.getElementById("source").value.split(',').map(Number);
            var dest = document.getElementById("destination").value.split(',').map(Number);
            
            if (window.routingControl) {
                map.removeControl(window.routingControl);
            }

            window.routingControl = L.Routing.control({
                waypoints: [
                    L.latLng(src[0], src[1]),
                    L.latLng(dest[0], dest[1])
                ],
                createMarker: () => null,
                lineOptions: { styles: [{ color: 'cyan', weight: 4 }] }
            }).addTo(map);
        }

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(position => {
                let userLocation = [position.coords.latitude, position.coords.longitude];
                let closest = Object.values(locations).reduce((a, b) => 
                    (getDistance(userLocation, a) < getDistance(userLocation, b) ? a : b));
                document.getElementById("source").value = closest;
            });
        }

        function getDistance(coord1, coord2) {
            return Math.sqrt(Math.pow(coord1[0] - coord2[0], 2) + Math.pow(coord1[1] - coord2[1], 2));
        }
    </script>
</body>
</html>
